require('dotenv').config();
const Airtable = require('airtable');

async function checkAIFields() {
  console.log('üîç Checking AI Field Requirements...\n');
  
  const base = new Airtable({
    apiKey: process.env.AIRTABLE_API_KEY
  }).base(process.env.AIRTABLE_BASE_ID);
  
  try {
    // Try to create a minimal record without AI fields
    const testId = `test-${Date.now()}`;
    
    const records = await base('Applicants').create([
      {
        fields: {
          "South African ID": "9001010001088",
          "Full Name": "AI Field Test",
          "Session ID": testId,
          "Funding Justification": "Test justification for AI fields"
        }
      }
    ]);
    
    console.log('‚úÖ Created test record without AI fields');
    console.log(`   Record ID: ${records[0].getId()}`);
    console.log(`   Session ID: ${testId}`);
    
    // Check if AI fields were auto-populated
    const retrieved = await base('Applicants').find(records[0].getId());
    
    if (retrieved.fields["Funding Justification Summary (AI)"]) {
      console.log('\nüìä AI Fields after creation:');
      console.log(`   ‚Ä¢ AI Summary: ${retrieved.fields["Funding Justification Summary (AI)"]}`);
      console.log(`   ‚Ä¢ AI Purpose Category: ${retrieved.fields["Funding Purpose Category (AI)"]}`);
      console.log('\n‚úÖ AI fields are auto-generated by Airtable!');
    } else {
      console.log('\n‚ö†Ô∏è AI fields were not auto-populated');
    }
    
    // Clean up - delete test record
    await base('Applicants').destroy([records[0].getId()]);
    console.log('\nüßπ Test record cleaned up');
    
  } catch (error) {
    console.error('‚ùå Error:', error.message);
  }
}

checkAIFields();